
### MYSQL基础架构
> MYSQL基础架构两层，SERVER层和引擎层
* SERVER层
> 连接器,管理连接，权限验证。分析器，分析sql语法。优化器，优化sql语法，选择索引。执行器，操作底层引擎，返回得到的结果。
* 引擎层
> 常用的 MyISAM,InnoDB 

### MYSQL日志
* binlog
> binlog 是SERVER层的日志，MYSQL自带的引擎是 MyISAM。有一个归档日志 binlog，所有引擎都可以使用。但是MyISAM没有crash-safe的能力，
所以出现了InnoDB引擎。
* redo log
> InnoDB引擎自带的日志，有crash-safe的能力

> 两种日志不同的是  redolog是 InnoDB特有的，binlog是MYSQL SERVER层实现的，大家都能用。
> redolog 记录的是物理日志，如：在某个数据页做了什么。binlog 记录的是原始的sql语句
> redolog 是循环写的，会覆盖，不能持久保存。binlog是可以追加写入，不会覆盖，可以写入磁盘持久保存

### 让数据库恢复到任意一段时间的任意一秒
> 执行语句的时候 binlog 会记录所有的逻辑操作，保存binlog备份，恢复到临时库，然后重放到需要找回的时段。

### 两阶段提交保证 日志一致性
> 由于InnoDB redolog 会循环覆盖，当MYSQL崩溃的时候做不了数据恢复，所以在执行语句的时候通常会先写入 binlog 逻辑日志，然后再写入 
> redolog，来保证MYSQL奔溃造成的数据问题。两种日志，任意一种记录失败都会回滚。

### Binlog有两种模式 
* statement 格式的话是记sql语句
* row格式会记录行的内容，记两条，更新前和更新后都有。